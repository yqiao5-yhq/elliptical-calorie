<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ¤­åœ†æœºè¿åŠ¨çƒ­é‡æ¶ˆè€—è®¡ç®—å™¨</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin: 10px 0 5px; }
    input, select { width: 200px; padding: 5px; }
    .required::after { content: '*'; color: red; margin-left: 5px; }
    button { margin-top: 20px; padding: 10px 20px; }
    #result, #recommendation { margin-top: 20px; white-space: pre-wrap; font-weight: bold; }
    #chartContainer { margin-top: 30px; width: 100%; max-width: 700px; }
  </style>
</head>
<body>
  <h1>æ¤­åœ†æœºè¿åŠ¨çƒ­é‡æ¶ˆè€—è®¡ç®—å™¨</h1>
  <label class="required">ä½“é‡ï¼ˆkgï¼‰</label>
  <input type="number" id="weight">

  <label class="required">æ€§åˆ«</label>
  <select id="gender">
    <option value="">è¯·é€‰æ‹©</option>
    <option value="male">ç”·</option>
    <option value="female">å¥³</option>
  </select>

  <label>å¿ƒç‡ï¼ˆbpmï¼‰</label>
  <input type="number" id="hr" value="150">

  <label>å¡åº¦ç­‰çº§</label>
  <input type="number" id="incline" value="5">

  <label>é˜»åŠ›ç­‰çº§</label>
  <input type="number" id="resistance" value="15">

  <label>é”»ç‚¼æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰</label>
  <input type="number" id="duration" value="60">

  <button onclick="calculateCalories()">è®¡ç®—</button>

  <div id="result"></div>
  <div id="recommendation"></div>
  <div id="chartContainer">
    <canvas id="calorieChart"></canvas>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let chart;

    function calculateCalories() {
      const weight = parseFloat(document.getElementById('weight').value);
      const gender = document.getElementById('gender').value;
      const hr = parseFloat(document.getElementById('hr').value) || 150;
      const incline = parseFloat(document.getElementById('incline').value) || 5;
      const resistance = parseFloat(document.getElementById('resistance').value) || 15;
      const duration = parseFloat(document.getElementById('duration').value) || 60;

      const resultDiv = document.getElementById('result');
      const recDiv = document.getElementById('recommendation');
      resultDiv.innerText = '';
      recDiv.innerText = '';

      if (!weight || !gender) {
        resultDiv.innerText = 'âŒ è¯·å¡«å†™ä½“é‡å’Œé€‰æ‹©æ€§åˆ«å†è¿›è¡Œè®¡ç®—ã€‚';
        return;
      }

      const genderFactor = gender === 'female' ? 0.93 : 1.0;
      const baseMET = (hr / 150) * 8 * genderFactor;
      const resistanceFactor = Math.sqrt(resistance) / Math.sqrt(20);
      const inclineFactor = Math.sqrt(incline) / Math.sqrt(10);
      let adjustedMET = baseMET * (1 + 0.1 * resistanceFactor + 0.05 * inclineFactor);
      adjustedMET = Math.max(1, Math.min(20, adjustedMET));

      const hours = duration / 60;
      const calories = adjustedMET * weight * hours;

      resultDiv.innerText =
        `âœ… ä¼°ç®— MET å€¼ï¼š${adjustedMET.toFixed(2)}\nâœ… ä¼°ç®—çƒ­é‡æ¶ˆè€—ï¼š${calories.toFixed(2)} åƒå¡`;

      const timePoints = [];
      const caloriePoints = [];
      for (let t = 0; t <= duration; t += 5) {
        timePoints.push(t);
        caloriePoints.push((adjustedMET * weight * t / 60).toFixed(2));
      }

      if (chart) chart.destroy();
      chart = new Chart(document.getElementById('calorieChart').getContext('2d'), {
        type: 'line',
        data: {
          labels: timePoints,
          datasets: [{
            label: 'ç´¯è®¡çƒ­é‡æ¶ˆè€—ï¼ˆåƒå¡ï¼‰',
            data: caloriePoints,
            borderColor: 'rgba(75, 192, 192, 1)',
            backgroundColor: 'rgba(75, 192, 192, 0.2)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          scales: {
            x: { title: { display: true, text: 'æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰' }},
            y: { title: { display: true, text: 'çƒ­é‡ï¼ˆåƒå¡ï¼‰' }}
          }
        }
      });

      // æ¨èå¡åº¦åŒºé—´ï¼ˆéçº¿æ€§ä½“é‡è°ƒèŠ‚ï¼‰
      const recommendedRange = [];
      for (let i = 1; i <= 15; i++) {
        const rawSlope = 1 / (2 * Math.sqrt(i));
        const deltaWeight = weight - 75;
        const weightFactor = 1 + 0.004 * Math.sqrt(Math.abs(deltaWeight)) * (deltaWeight >= 0 ? 1 : -1);
        const effectiveSlope = rawSlope * weightFactor;
        if (effectiveSlope >= 0.20 && effectiveSlope <= 0.25) {
          recommendedRange.push(i);
        }
      }

      const baseStrength = weight / 6;
      const lowRes = Math.max(5, Math.floor(baseStrength * 0.9));
      const highRes = Math.min(20, Math.ceil(baseStrength * 1.1));
      const targetHR = gender === 'female' ? 140 : 150;

      const recText = `ğŸ¯ æ¨èè®¾ç½®ï¼ˆåŸºäº ${weight}kgï¼‰ï¼š\n- æ¨èå¡åº¦èŒƒå›´ï¼š${recommendedRange.length ? recommendedRange.join(' ~ ') : 'æ— '}\n  ï¼ˆè€ƒè™‘ä½“é‡åçš„æ–œç‡åŒºé—´ 0.25~0.20ï¼‰\n- å»ºè®®é˜»åŠ›ï¼š${lowRes} ~ ${highRes}\n- å»ºè®®å¿ƒç‡ï¼š${targetHR} bpm`;

      recDiv.innerText = recText;
    }
  </script>
</body>
</html>
